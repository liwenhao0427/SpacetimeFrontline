# 玩家属性设计文档 (v1.0)

## 1. 引言

本文档详细定义了《超时空防线》中玩家全局属性对象 (`PlayerStats`) 的所有字段。这个核心对象整合了玩家通过购买道具、升级和获取临时增益所累积的所有能力。理解这些属性是进行游戏平衡、设计新道具和新单位的基础。

所有属性的最终值都是通过 `calculateFinalStats` 函数在每波次开始前或购买新道具后重新计算的。该函数会重置所有战斗属性为初始值，然后遍历玩家拥有的所有道具 (`ownedItems`)，将它们的效果累加到新的属性对象上。

---

## 2. 核心资源与进程

这些属性代表了玩家的核心资源和游戏进度。

| 属性名 | 类型 | 描述 |
| :--- | :--- | :--- |
| `gold` | `number` | **金币**：游戏内的主要货币，用于在商店中购买单位、道具和经验值。通过击杀敌人和`收获`属性获得。|
| `wave` | `number` | **当前波数**：标记玩家当前所处的战斗波数。初始为 `0`，在第一波战斗开始时变为 `1`。|

### 2.1 英雄永久成长

这组属性追踪英雄的**永久等级**，该等级在整局游戏中持续存在，并通过在商店购买经验值来提升。

| 属性名 | 类型 | 描述 |
| :--- | :--- | :--- |
| `heroLevel` | `number` | **英雄等级**：英雄的永久等级。|
| `heroXp` | `number` | **英雄当前经验**：英雄当前等级获得的经验值。|
| `heroMaxXp`| `number` | **英雄升级所需经验**：英雄升至下一级所需的总经验值。|

### 2.2 战内临时等级

这组属性是 `heroLevel` 属性的“HUD别名”，用于在战斗中显示玩家的**临时等级**。该等级在战斗中通过杀敌获取经验来提升，但在每波次结束后的商店阶段会重置回英雄的永久等级。

| 属性名 | 类型 | 描述 |
| :--- | :--- | :--- |
| `level` | `number` | **战内等级**：在战斗UI上显示的玩家当前等级。|
| `xp` | `number` | **战内当前经验**：当前等级获得的经验值。|
| `maxXp`| `number` | **战内升级所需经验**：升至下一级所需的总经验值。|

---

## 3. 全局战斗属性

这些是影响所有单位或英雄核心战斗能力的基础属性。

### 3.1 伤害类属性

| 属性名 | 类型 | 描述与公式 |
| :--- | :--- | :--- |
| `damagePercent` | `number` | **伤害加成(%)**：一个**乘法区**的全局伤害加成。例如 `0.15` 代表 `+15%` 伤害。最终伤害会乘以 `(1 + damagePercent)`。|
| `critChance` | `number` | **暴击率(%)**：所有攻击触发暴击的概率。例如 `0.05` 代表 `5%` 的暴击率。 |

### 3.2 速度与频率类属性

| 属性名 | 类型 | 描述与公式 |
| :--- | :--- | :--- |
| `attackSpeed` | `number` | **攻击速度(%)**：一个**除法区**的全局攻速加成。例如 `0.2` 代表 `+20%` 攻速。最终冷却时间会除以 `(1 + attackSpeed)`。|
| `speed` | `number` | **弹射物速度**：【预留属性】用于调整弹射物的飞行速度。当前版本中该值固定。|

### 3.3 生存类属性

| 属性名 | 类型 | 描述与公式 |
| :--- | :--- | :--- |
| `flatHp` | `number` | **扁平生命值**：为所有单位提供一个固定的基础生命值加成。这个值会受到单位自身`hpScaling`系数的影响。|
| `hpPercent` | `number` | **百分比生命值(%)**：为所有单位提供一个百分比最大生命值加成。同样会受到`hpScaling`系数的影响。|

**单位最终生命值计算:**
```
FinalHP = (BaseHP + flatHp * hpScaling) * (1 + hpPercent * hpScaling)
```

### 3.4 功能类属性

| 属性名 | 类型 | 描述 |
| :--- | :--- | :--- |
| `luck` | `number` | **幸运值**：影响商店中高稀有度物品的出现概率，以及某些道具的触发几率。|
| `xpGain` | `number` | **经验获取加成(%)**：提升从击杀敌人中获得的经验值数量。例如 `0.25` 代表 `+25%` 经验。|

---

## 4. 专精伤害属性 (扁平伤害)

这是一组**扁平伤害**属性。它们会根据单位的 `scaling`（伤害成长系数）属性，被加到单位的基础伤害上，处于**伤害计算的最底层**。

| 属性名 | 类型 | 描述 |
| :--- | :--- | :--- |
| `meleeDmg` | `number` | **近战伤害**：对 `type: 'MELEE'` 的单位生效。|
| `rangedDmg` | `number` | **远程伤害**：对 `type: 'RANGED'` 的单位生效。|
| `elementalDmg` | `number` | **魔法伤害**：对 `type: 'MAGIC'` 的单位生效。|

**伤害计算中的应用:**
```
ScaledFlatBonus = (stats.meleeDmg * scaling.meleeDmg) + ... // 其他类型
FinalDmg = (BaseDmg + ScaledFlatBonus) * Multipliers...
```

---

## 5. 经济与特殊属性

| 属性名 | 类型 | 描述 |
| :--- | :--- | :--- |
| `harvesting` | `number` | **收获**：在每波战斗结束后，提供等同于此数值的金币奖励。|
| `shopDiscount`| `number` | **商店折扣(%)**：降低商店中所有商品的价格。例如 `10` 代表 `10%` 的折扣。|
| `lastHarvestYield`| `number`| **上次收获产出**：仅用于UI显示，告知玩家上一波通过`收获`属性获得了多少金币。|

---

## 6. 临时与英雄专属属性

这些属性要么是仅在当前波次生效的临时增益，要么是专门为英雄单位设计的特殊属性。

### 6.1 波次临时增益

在战斗中升级时获得的临时增益，在进入下一波的商店阶段时会被重置为 `0`。

| 属性名 | 类型 | 描述 |
| :--- | :--- | :--- |
| `tempDamageMult` | `number` | **临时伤害加成(%)**：构成一个独立的伤害乘区 `(1 + tempDamageMult)`。|
| `tempAttackSpeedMult` | `number` | **临时攻速加成(%)**：构成一个独立的攻速乘区 `(1 + tempAttackSpeedMult)`。|

### 6.2 英雄独立乘区

通过英雄升级获得的属性，为英雄单位提供独立的乘法区，可以为负数。

| 属性名 | 类型 | 描述 |
| :--- | :--- | :--- |
| `heroDamageMult` | `number` | **英雄伤害乘数(%)**：英雄专属的伤害乘区 `(1 + heroDamageMult)`。多重射击等升级会使其为负。|
| `heroAttackSpeedMult` | `number` | **英雄攻速乘数(%)**：英雄专属的攻速乘区 `(1 + heroAttackSpeedMult)`。弹射等升级会使其为负。|

### 6.3 英雄能量与大招

| 属性名 | 类型 | 描述 |
| :--- | :--- | :--- |
| `heroEnergyGainRate`| `number`| **英雄能量获取率**：英雄自动回复能量速度的倍率。`1.0` 为基础速率。|
| `heroMaxEnergy`| `number`| **英雄最大能量**：释放终极技能所需的能量上限。|
| `ult_speed_mult`| `number`| **大招攻速倍率**：终极技能期间的攻击速度倍率。`3` 代表3倍速。**直接作为除数**作用于冷却时间。|
| `ult_dmg_bonus`| `number`| **大招伤害加成(%)**：终极技能期间的额外伤害乘数 `(1 + ult_dmg_bonus)`。|
| `ult_kill_extend`| `number`| **大招击杀延长**：终极技能期间每次击杀延长的时间（秒）。|

---

## 7. 成长与动态属性

这些属性为“成长型”道具或机制预留，允许属性随游戏进程（如波数）自动增长。

| 属性名 | 类型 | 描述 |
| :--- | :--- | :--- |
| `meleeDmgGrowth` | `number` | **近战伤害成长**: 每波次结束后，近战伤害会额外增加的数值。 |
| `rangedDmgGrowth` | `number` | **远程伤害成长**: 每波次结束后，远程伤害会额外增加的数值。 |
| `elementalDmgGrowth` | `number` | **魔法伤害成长**: 每波次结束后，魔法伤害会额外增加的数值。 |
| `hpGrowth` | `number` | **生命值成长**: 每波次结束后，`flatHp` 会额外增加的数值。 |
| `[key: string]`| `any` | **索引签名**：允许道具系统动态地添加任何未在 `PlayerStats` 中明确定义的属性，极大地增强了未来扩展新道具和新机制的灵活性。|

---

## 附录 A: 属性价值与定价模型 (v2.0)

本附录旨在为道具设计提供一个量化的经济模型，确保游戏内经济的平衡性。

### A.1 定价哲学

- **核心原则**: 道具的定价应基于其提供的**属性价值总和**。
- **价值基准**: `+2 近战伤害` = `+1 远程伤害` = `+1 魔法伤害` = **30 金币**。所有其他属性的价值都基于此基准进行派生，以确保伤害属性的核心价值地位。
- **负面属性**: 道具附带的负面属性会**降低**其总价值，但其折价幅度仅为该属性正面价值的 **50%**。这使得带有负面效果的道具在策略上更具吸引力，但不会完全抵消其成本。
- **多重增益折扣**: 当一个道具同时提供多个正面属性时，其总价会获得一个**折扣**，以鼓励玩家购买复合型道具。
    - 2个正面属性: **-5%** 总价
    - 3个正面属性: **-10%** 总价
    - 4个或以上: **-15%** 总价
- **稀有度**: 道具的稀有度 (Tier) **不直接影响**价格倍率，而是决定了该道具可能拥有的属性总量和效果的复杂度。

### A.2 核心属性价值换算表

下表定义了各项核心属性每“点”所对应的近似金币价值，所有价值均由伤害基准派生而来。

| 属性 | 单位 | 每单位价值 (约等金币) | 备注 |
| :--- | :--- | :--- | :--- |
| `meleeDmg` | +1 | 15 G | 伤害基准，最具成本效益的扁平伤害。 |
| `rangedDmg` | +1 | 30 G | 伤害基准。 |
| `elementalDmg` | +1 | 30 G | 伤害基准。 |
| `damagePercent` | +1% | 8 G | 乘法区属性，价值随游戏进程提升。 |
| `attackSpeed` | +1% | 7 G | 游戏中最关键的DPS放大器之一。 |
| `critChance` | +1% | 10 G | 暴击收益依赖于其他构筑，基础价值较高。 |
| `flatHp` | +1 | 1 G | 受单位自身 `hpScaling` 影响，基础价值适中。 |
| `hpPercent` | +1% | 5 G | 对高基础生命值的单位收益巨大。 |
| `harvesting` | +1 | 4 G | 纯粹的经济属性，能产生复利效应。 |
| `luck` | +1 | 3 G | 影响概率，收益不稳定，定价较低。 |
| `xpGain` | +1% | 5 G | 加速成长的投资属性。 |
| `shopDiscount` | 1% | 8 G | 直接的经济节省，价值等同于伤害加成。 |
| `enemy_count` | -1% | 15 G | 强大的防御向属性，直接降低战场压力。 |
| `knockback` | +1 | 5 G | 控制类属性，用于打断和推迟敌人。 |
| `explosion_dmg`| +1% | 2 G | 对范围伤害构筑的核心加成。 |
| `burn_chance` | +1% | 1 G | 持续伤害(DOT)构筑的触发属性。 |
