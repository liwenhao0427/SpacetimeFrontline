# 游戏数值设计文档 (v2.0)

## 1. 概述

本文档旨在阐明《超时空防线》的核心数值模型与平衡哲学。理解这些公式和设计意图对于未来的功能迭代和游戏平衡性调整至关重要。

---

## 2. 核心战斗公式

所有单位的最终战斗属性都由其 **基础值** 和玩家全局的 **`PlayerStats`** 共同决定。核心原则是：**所有百分比增益都以乘法叠加**，形成不同的“乘区”。

### 2.1 伤害计算模型

**完整公式:**
```
FinalDmg = round( (BaseDmg + ScaledFlatBonus + EffectFlatBonus) * GlobalMultiplier * TempMultiplier * HeroMultiplier )
```

**公式分解:**

| 参数 | 构成 | 来源 | 解释 |
| :--- | :--- | :--- | :--- |
| **`BaseDmg`** | `unit.baseDamage` | `data/units.ts` | 单位自身的基础攻击力。 |
| **`ScaledFlatBonus`** | `(stats.meleeDmg * scaling.meleeDmg) + ...` | 道具 (`BrotatoItem`) | 根据单位的 `scaling` 属性，将玩家的扁平伤害属性 (`meleeDmg` 等) 按比例加成到基础伤害上。 |
| **`EffectFlatBonus`** | `unit.effects.stick_bonus` | 单位特效 | 来自单位自身特效的额外扁平伤害（例如"树枝"）。 |
| **`GlobalMultiplier`** | `(1 + stats.damagePercent)` | 道具 | 来自所有永久道具的全局伤害增益，构成一个独立的乘区。 |
| **`TempMultiplier`** | `(1 + stats.tempDamageMult)` | 战内升级 | 来自战斗中升级选项的临时伤害增益，仅在本波次生效。 |
| **`HeroMultiplier`** | `(1 + stats.heroDamageMult) * UltimateMultiplier` | 英雄升级 | 英雄独有的伤害乘区。**注意：此值可为负** (例如多重射击)。 |
| **`UltimateMultiplier`** | `(1 + stats.ult_dmg_bonus)` | 英雄升级 | 仅在英雄释放终极技能（大招）期间生效的额外伤害乘数。 |

---

### 2.2 冷却时间 (攻击速度) 计算模型

**完整公式:**
```
FinalCooldown = BaseCooldown / (GlobalMultiplier * TempMultiplier * HeroMultiplier)
// If Hero is Ulting:
FinalCooldown = FinalCooldown / stats.ult_speed_mult
```

**公式分解:**

| 参数 | 构成 | 来源 | 解释 |
| :--- | :--- | :--- | :--- |
| **`BaseCooldown`** | `unit.maxCooldown` | `data/units.ts` | 单位的基础攻击间隔（秒）。 |
| **`GlobalMultiplier`** | `(1 + stats.attackSpeed)` | 道具 | 来自所有永久道具的全局攻击速度增益。 |
| **`TempMultiplier`** | `(1 + stats.tempAttackSpeedMult)` | 战内升级 | 仅在本波次生效的临时攻速增益。 |
| **`HeroMultiplier`** | `(1 + stats.heroAttackSpeedMult)` | 英雄升级 | 英雄独有的攻速乘区。**注意：此值可为负** (例如弹射升级)。 |
| **`stats.ult_speed_mult`** | 英雄基础 + 升级 | 英雄大招期间的最终攻速倍率，此数值**直接作为除数**，而非乘数。 |

---

## 3. 英雄升级平衡哲学

英雄的成长设计围绕着 **“机遇与风险”** 的核心理念。强大的能力往往伴随着一定的代价，鼓励玩家进行策略性选择和构筑。

### 3.1 初始状态
*   **基础伤害 (`baseDamage`): 12**
*   **大招攻速倍率 (`ult_speed_mult`): 3** (即 `+200%` 攻速)

**设计意图:** 英雄的初始伤害较低，无法独当一面，强调了前期依赖其他单位进行防御的策略性。其大招拥有强大的爆发力 (3倍速)，使其成为一个高风险、高回报的“决战兵器”。

### 3.2 多重射击路径 (Multishot)

| 等级 | 效果 | 伤害惩罚 (独立乘区) | 理论总伤害倍率 (相比单发) |
| :--- | :--- | :--- | :--- |
| 1 | 双重射击 | `-20%` | `2 * (1 - 0.2) = 1.6x` |
| 2 | 三向射击 | `-20%` (累计-40%) | `3 * (1 - 0.4) = 1.8x` |
| 3 | 五向射击 | `-20%` (累计-60%) | `5 * (1 - 0.6) = 2.0x` |

**设计意图:** 以单体伤害换取覆盖范围。总伤害输出是提升的，但对单个目标的压制力会因伤害惩罚而减弱。这鼓励玩家去寻找能附加额外效果（如爆炸、燃烧）的道具，让每一发子弹的价值最大化。

### 3.3 弹射路径 (Bounce)

| 等级 | 效果 | 攻速惩罚 (独立乘区) |
| :--- | :--- | :--- |
| 1 | +1 弹射 | `-10%` |
| 2 | +1 弹射 (总计2) | `-10%` (累计-20%) |
| 3 | +2 弹射 (总计4) | `-10%` (累计-30%) |
| 4 | +6 弹射 (总计10) | `-10%` (累计-40%) |

**设计意图:** 以攻击频率换取清场能力。弹射次数的增加极大地提升了对密集敌群的控制力，但攻速的降低削弱了对单体精英或Boss的持续输出。

### 3.4 终极技能路径 (Ultimate)

| 等级 | 效果 | 数值变化 |
| :--- | :--- | :--- |
| 1 | 超频 | 大招攻速倍率从 3x 提升至 **4x** |
| 2 | 毁灭 | 大招期间伤害 **+25%** |
| 3 | 持久 | 大招基础持续时间 **+1.5秒** |
| 4 | 虹吸 | 大招期间每次击杀延长 **0.1秒** 持续时间 |

### 3.5 无限成长路径 (蛮力 / 神经加速)
*   **英雄蛮力:** `+50%` 英雄伤害 (独立乘区)。
*   **神经加速:** `+30%` 英雄攻速 (独立乘区)。

**设计意图:** 提供稳定、无风险的成长选项。当其他路径的负面效果与当前构筑不符时，选择这些基础属性提升永远是正确的。

---

## 4. 敌人成长模型

### 4.1 属性成长
敌人的生命值会随着波数线性增长，以确保后期挑战性。

*   **公式:** `FinalHP = enemy.baseHp + enemy.hpPerWave * (wave - 1)`
*   **来源:** `data/enemies.ts`

### 4.2 数量成长
*   **基础数量:** 由 `data/waves.ts` 中的 `totalCount` 定义。
*   **玩家修正:** 玩家持有的某些道具 (如“友善的外星蛙”) 会增加 `stats.enemy_count` 属性，最终敌人数量会乘以 `(1 + stats.enemy_count / 100)`。

---

## 5. 商店与经济模型

### 5.1 刷新 (Reroll) 成本
刷新商店的成本会随着**波数**和**当前波次的刷新次数**递增。

*   **公式:** `Cost = floor((1 + max(0, wave - 1) + rerollCount) * PRICE_MULTIPLIER)`
    * `PRICE_MULTIPLIER`: 全局价格倍率，当前为 `1.5`。
*   **设计意图:** 鼓励玩家在前几波做出决策，而不是无限刷新以寻求最优解。

### 5.2 物品/单位掉落概率
商店出现何种稀有度（Tier）的物品/单位，主要由**波数**和**幸运值 (`luck`)**决定。

*   **解锁门槛 (`TIER_GATES`):**
    * Tier 1: Wave 1+
    * Tier 2: Wave 3+
    * Tier 3: Wave 8+
    * Tier 4: Wave 15+
*   **权重计算 (`TIER_WEIGHTS_CONFIG`):** 每个解锁的稀有度等级都有一个基础权重，该权重会根据当前波数和玩家的幸运值进行动态调整。
    * **公式 (示例 Tier 2):** `Weight = 0 + (Wave * 10) + (Luck * 2)`
    * **设计意图:** 波数是解锁和提升高稀有度物品出现概率的主要因素。幸运值则进一步修正这个概率，让“幸运流”成为一种可行的玩法。
*   **单位 vs 物品:**
    * **基础概率:** 40% 单位 / 60% 物品。
    * **幸运值影响:** 每点幸运值会使单位的出现概率提升 `0.5%`。
    * **公式:** `UnitChance = clamp(0, 1, 0.40 + luck * 0.005)`